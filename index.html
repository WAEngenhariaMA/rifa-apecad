
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>üéüÔ∏è Rifa APECAD 2025 v1</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    .grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; max-width: 600px; margin: auto; }
    .btn { padding: 10px; background: #00cc00; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .ocupado { background: gray !important; cursor: not-allowed; }
    .selecionado { background: orange !important; }
    input { padding: 8px; margin: 5px; width: 250px; }
  </style>
</head>
<body>

  <h2>üéüÔ∏è <strong>Rifa APECAD 2025</strong></h2>
  <p>Cada n√∫mero custa <strong>R$ 10,00</strong>. Escolha seus n√∫meros abaixo:</p>

  <div id="grid" class="grid"></div>

  <br>
  <input type="text" id="nome" placeholder="Seu nome completo"><br>
  <input type="text" id="tel" placeholder="Seu telefone ou WhatsApp"><br><br>
  <button onclick="enviar()">‚úÖ Reservar N√∫meros</button>
  <p id="resposta"></p>

  <script>
    const grid = document.getElementById("grid");
    let selecionados = [];

    for (let i = 1; i <= 200; i++) {
      let n = String(i).padStart(3, '0');
      let btn = document.createElement("button");
      btn.innerText = n;
      btn.className = "btn";
      btn.onclick = () => {
        if (btn.classList.contains("ocupado")) return;
        btn.classList.toggle("selecionado");
        if (selecionados.includes(n)) {
          selecionados = selecionados.filter(num => num !== n);
        } else {
          selecionados.push(n);
        }
      };
      btn.id = "btn" + n;
      grid.appendChild(btn);
    }

    async function carregarOcupados() {
      const res = await fetch("https://opensheet.elk.sh/1tqeY7nKhF_tQfWCpB9hXY-TCSKkAtjBvT-fqHZeu8wU/P√°gina1");
      const dados = await res.json();
      dados.forEach(row => {
        if (row.clnnumero) {
          row.clnnumero.split(',').map(n => n.trim()).forEach(numero => {
            let btn = document.getElementById("btn" + numero);
            if (btn) {
              btn.classList.add("ocupado");
              btn.disabled = true;
            }
          });
        }
      });
    }

    async function enviar() {
      const nome = document.getElementById("nome").value.trim();
      const tel = document.getElementById("tel").value.trim();
      if (!nome || !tel || selecionados.length === 0) {
        alert("Preencha todos os campos e selecione pelo menos um n√∫mero.");
        return;
      }

      const res = await fetch("https://script.google.com/macros/s/AKfycbzv1DHfQKvXsEWNx-fddoMktp5aQWvCSwpa8LWdtLpmp9eCNPoF3S5MJ3jvxc4d3chIqQ/exec", {
        method: "POST",
        body: JSON.stringify({ nome: nome, telefone: tel, numeros: selecionados }),
        headers: { "Content-Type": "application/json" }
      });

      const txt = await res.text();
      document.getElementById("resposta").innerText = txt === "OK" 
        ? "‚úÖ N√∫meros reservados com sucesso!" 
        : "‚ùå Erro: algum n√∫mero j√° foi escolhido.";
      if (txt === "OK") location.reload();
    }

    carregarOcupados();
  </script>

</body>
</html>
